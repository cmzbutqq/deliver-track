# ç”µå•†ç‰©æµé…é€å¯è§†åŒ–å¹³å° (Project Spec)

> **æ–‡æ¡£çŠ¶æ€**: å‰åç«¯éœ€æ±‚å·²å…¨éƒ¨æ˜ç¡® (2025-11-23)  
> **åç«¯è¿›åº¦**: âœ… 100% å®Œæˆå¹¶é€šè¿‡å…¨éƒ¨æµ‹è¯• (66ä¸ªå•å…ƒæµ‹è¯• + 42ä¸ªE2Eæµ‹è¯•)  
> **å‰ç«¯è¿›åº¦**: â³ å¾…å¼€å‘ï¼ˆéœ€æ±‚å·²æ˜ç¡®ï¼‰

## 1. é¡¹ç›®æ¦‚è¿°
æœ¬é¡¹ç›®æ—¨åœ¨æ„å»ºä¸€ä¸ªç«¯åˆ°ç«¯çš„**ç”µå•†ç‰©æµé…é€å¯è§†åŒ–å¹³å°**ï¼Œæ ¸å¿ƒç›®æ ‡æ˜¯å®ç°ä»å•†å®¶å‘è´§åˆ°ç”¨æˆ·æ”¶è´§çš„å…¨æµç¨‹é—­ç¯ï¼Œå¹¶é‡ç‚¹å±•ç¤ºåŸºäºåœ°å›¾çš„å®æ—¶ç‰©æµè½¨è¿¹è¿½è¸ªã€‚

**å·²å®ç°æˆæœ**ï¼š
- âœ… å®Œæ•´çš„åç«¯æœåŠ¡ï¼ˆNestJS + PostgreSQL + Prismaï¼‰
- âœ… 10 å¤§æ ¸å¿ƒåŠŸèƒ½æ¨¡å—å…¨éƒ¨å®ç°å¹¶æµ‹è¯•é€šè¿‡
- âœ… é«˜å¾·åœ°å›¾çœŸå®è·¯ç½‘é›†æˆï¼ˆ57ä¸ªçœŸå®è·¯å¾„ç‚¹ï¼Œæ”¯æŒé™çº§ç­–ç•¥ï¼‰
- âœ… WebSocket å®æ—¶æ¨é€ç³»ç»Ÿï¼ˆå« delivery_complete äº‹ä»¶ï¼‰
- âœ… è‡ªåŠ¨åŒ–è½¨è¿¹æ¨¡æ‹Ÿä¸å®šæ—¶ä»»åŠ¡
- âœ… ç‰©æµå…¬å¸ç®¡ç†ç³»ç»Ÿï¼ˆ6å®¶é¢„ç½®å…¬å¸ï¼‰
- âœ… å•†å®¶å‘è´§åœ°å€ç®¡ç†
- âœ… è®¢å•æ‰¹é‡æ“ä½œï¼ˆå‘è´§/åˆ é™¤ï¼‰
- âœ… æ•°æ®ç»Ÿè®¡åˆ†ææ¥å£ï¼ˆæ€»è§ˆ/åŒºåŸŸ/ç‰©æµå…¬å¸ï¼‰
- âœ… å®Œæ•´çš„æµ‹è¯•å¥—ä»¶ï¼ˆå•å…ƒæµ‹è¯• + E2Eæµ‹è¯• + æ¼”ç¤ºæµ‹è¯•ï¼‰

## 2. è¯¾é¢˜è¦æ±‚
åŸºäº Reactã€Node.jsã€TypeScript ä»¥åŠåœ°å›¾æœåŠ¡ç­‰æŠ€æœ¯æ ˆï¼Œæ„å»ºä¸€ä¸ªè¦†ç›–å•†å®¶ã€ç”¨æˆ·ã€åç«¯æœåŠ¡ä¸‰ç«¯çš„å…¨æ ˆé¡¹ç›®ã€‚é¡¹ç›®éœ€å®ç°ç‰©æµé…é€åœºæ™¯çš„ä¸šåŠ¡é—­ç¯ï¼Œå¹¶é‡ç‚¹çªå‡ºå‰ç«¯åœ¨æ•°æ®å¯è§†åŒ–ä¸å®æ—¶äº¤äº’æ–¹é¢çš„å¤æ‚åº¦å’Œä»·å€¼ã€‚

## 3. æŠ€æœ¯æ ˆé€‰å‹

### 3.1 å‰ç«¯ (Frontend)
*   **æ¡†æ¶**: React 18 + TypeScript
*   **æ„å»ºå·¥å…·**: Vite
*   **çŠ¶æ€ç®¡ç†**: Context API + Zustand
*   **UI ç»„ä»¶åº“**: Ant Design (ç”¨äºå•†å®¶åå°ç®¡ç†)
*   **åœ°å›¾å¼•æ“**: é«˜å¾·åœ°å›¾ (AMap) JS API v2.0
    *   ä½¿ç”¨ `@amap/amap-jsapi-loader` è¿›è¡ŒåŠ è½½
    *   éœ€è¦é«˜å¾· JS API Key å’Œå®‰å…¨å¯†é’¥ï¼ˆJscodeï¼‰
*   **æ•°æ®å¯è§†åŒ–**: ECharts (ç”¨äºæ•°æ®çœ‹æ¿ï¼ŒåŒ…å« Geo åœ°ç†åæ ‡ç³»)
*   **HTTP å®¢æˆ·ç«¯**: Axios
*   **å®æ—¶é€šä¿¡**: Socket.io-clientï¼ˆæ”¯æŒæ–­çº¿é‡è¿ï¼‰
*   **äºŒç»´ç ç”Ÿæˆ**: qrcode.react (å•†å®¶ç«¯è®¢å•äºŒç»´ç )
*   **åŠ¨ç”»åº“**: é«˜å¾·åœ°å›¾åŸç”ŸåŠ¨ç”» API (è½¦è¾†ç§»åŠ¨åŠ¨ç”»)

### 3.2 åç«¯ (Backend)
*   **æ¡†æ¶**: NestJS (åŸºäº TypeScript çš„æ¸è¿›å¼ Node.js æ¡†æ¶)
*   **æ•°æ®åº“**: PostgreSQL (ä½¿ç”¨ JSON å­˜å‚¨åœ°ç†æ•°æ®)
*   **ORM**: Prisma
*   **è®¤è¯**: Passport (Local Strategy + JWT Strategy)
*   **å¯†ç åŠ å¯†**: bcryptjs
*   **å®æ—¶é€šä¿¡**: Socket.io (NestJS Gateway)
*   **ä»»åŠ¡è°ƒåº¦**: @nestjs/schedule (Cron å®šæ—¶ä»»åŠ¡)
*   **å¤–éƒ¨æœåŠ¡**: é«˜å¾·åœ°å›¾ Web æœåŠ¡ API (ç”¨äºè·¯å¾„è§„åˆ’ï¼Œæ”¯æŒé™çº§ç­–ç•¥)

### 3.3 åŸºç¡€è®¾æ–½ä¸å·¥å…·
*   **å®¹å™¨åŒ–**: Docker & Docker Compose (PostgreSQL æ•°æ®åº“æœåŠ¡)
*   **åŒ…ç®¡ç†**: pnpm
*   **ä»£ç è§„èŒƒ**: ESLint, Prettier
*   **æµ‹è¯•å·¥å…·**: 
    *   å±•ç¤ºæ€§æµ‹è¯•ï¼š`backend/tests/demo.test.ts` (å®Œæ•´è‡ªåŠ¨åŒ–æ¼”ç¤º)
    *   äº¤äº’å¼æµ‹è¯•ï¼š`backend/tests/api-showcase.ts` (èœå•å¼åŠŸèƒ½æ¼”ç¤º)

## 4. ç³»ç»Ÿæ¶æ„è®¾è®¡

### 4.1 åº”ç”¨æ¶æ„
**å•åº”ç”¨å¤šè·¯ç”±è®¾è®¡**ï¼ˆæ— éœ€åŸŸåçº§åˆ«éš”ç¦»ï¼‰ï¼š
- å•†å®¶ç«¯è·¯ç”±ï¼š`/merchant/*`ï¼ˆéœ€ JWT è®¤è¯ï¼‰
- ç”¨æˆ·ç«¯è·¯ç”±ï¼š`/track/*`ï¼ˆå…¬å¼€è®¿é—®ï¼‰

**è·¯ç”±ç»“æ„**ï¼š
```
å•†å®¶ç«¯ï¼ˆéœ€ç™»å½•ï¼‰ï¼š
/merchant/login       - ç™»å½•é¡µ
/merchant/dashboard   - æ•°æ®çœ‹æ¿
/merchant/orders      - è®¢å•åˆ—è¡¨ï¼ˆå«åœ°å›¾ç»„ä»¶ï¼‰
/merchant/orders/new  - åˆ›å»ºè®¢å•
/merchant/zones       - é…é€åŒºåŸŸç®¡ç†

ç”¨æˆ·ç«¯ï¼ˆæ— éœ€ç™»å½•ï¼‰ï¼š
/track                - ç‰©æµæŸ¥è¯¢é¡µï¼ˆè¾“å…¥è®¢å•å·ï¼‰
/track/:orderNo       - å®æ—¶è¿½è¸ªé¡µï¼ˆåœ°å›¾ + æ—¶é—´è½´ï¼‰
```

### 4.2 æ ¸å¿ƒæ¨¡å—
1.  **å•†å®¶ç«¯ (Merchant Portal)**
    *   åŸºäº Ant Design çš„ç®¡ç†åå°ã€‚
    *   åŠŸèƒ½ï¼šè®¢å•ç®¡ç†ï¼ˆå«å¤šé€‰æ‰¹é‡æ“ä½œï¼‰ã€æ¨¡æ‹Ÿå‘è´§ã€é…é€åŒºåŸŸåœˆé€‰ã€æ•°æ®çœ‹æ¿ã€CSVå¯¼å‡ºã€äºŒç»´ç ç”Ÿæˆã€‚
    *   é‰´æƒï¼šJWT ç™»å½•ã€‚
2.  **ç”¨æˆ·ç«¯ (User Tracker)**
    *   ç§»åŠ¨ç«¯å‹å¥½çš„å“åº”å¼é¡µé¢ï¼ˆæœ€å°å®½åº¦ 375pxï¼‰ã€‚
    *   åŠŸèƒ½ï¼šç‰©æµæŸ¥è¯¢ã€åœ°å›¾å®æ—¶è½¨è¿¹å±•ç¤ºã€ç‰©æµæ—¶é—´è½´ã€å¹³æ»‘åŠ¨ç”»ã€‚
    *   é‰´æƒï¼šå…ç™»å½•ï¼Œå‡­è®¢å•å·æŸ¥è¯¢ã€‚
    *   æ”¯æŒæ¨ªç«–å±ã€è§¦æ‘¸æ‰‹åŠ¿ã€‚
3.  **åç«¯æœåŠ¡ (Core Service)**
    *   **API å±‚**: æä¾› RESTful æ¥å£å¤„ç† CRUDã€‚
    *   **Gateway å±‚**: WebSocket æœåŠ¡ï¼Œè´Ÿè´£å®æ—¶åæ ‡æ¨é€ã€‚
    *   **Task å±‚**: æ¨¡æ‹Ÿå™¨ (Simulator)ï¼Œè´Ÿè´£ç”Ÿæˆè½¨è¿¹å¹¶å®šæ—¶é©±åŠ¨è®¢å•çŠ¶æ€æµè½¬ã€‚

### 4.2 æ•°æ®æµå‘
*   **æ¨¡æ‹Ÿå‘è´§**: 
    1. å•†å®¶è°ƒç”¨ `/orders/:id/ship` æ¥å£ã€‚
    2. åç«¯è°ƒç”¨é«˜å¾· API `/v3/direction/driving` è§„åˆ’è·¯å¾„ã€‚
    3. é‡‡æ ·è·¯å¾„ç‚¹å¹¶å­˜å…¥ Route è¡¨ï¼ˆä½œä¸ºç¼“å­˜ï¼‰ã€‚
    4. æ›´æ–°è®¢å•çŠ¶æ€ä¸º SHIPPINGï¼Œåˆ›å»º"å·²æ½æ”¶"æ—¶é—´çº¿ã€‚
    5. Cron å®šæ—¶ä»»åŠ¡è‡ªåŠ¨æ¥ç®¡è¯¥è®¢å•çš„ä½ç½®æ¨è¿›ã€‚
*   **å®æ—¶è¿½è¸ª**: 
    1. ç”¨æˆ·ç«¯ WebSocket è¿æ¥ `socket.io` æœåŠ¡å™¨ã€‚
    2. å‘é€ `subscribe` äº‹ä»¶è®¢é˜…è®¢å•å·ï¼ˆåŠ å…¥ Roomï¼‰ã€‚
    3. ç«‹å³æ”¶åˆ°å½“å‰ä½ç½®ã€çŠ¶æ€ã€è¿›åº¦ã€‚
    4. Cron ä»»åŠ¡æ¯ 5 ç§’ tick ä¸€æ¬¡ã€‚
    5. æ›´æ–° Route çš„ `currentStep` å’Œè®¢å•çš„ `currentLocation`ã€‚
    6. WebSocket å¹¿æ’­ `location_update` äº‹ä»¶åˆ°è¯¥è®¢å• Roomã€‚
    7. å‰ç«¯æ¥æ”¶ä½ç½®æ•°æ®ï¼Œä½¿ç”¨æ’å€¼åŠ¨ç”»å¹³æ»‘æ¸²æŸ“ã€‚
    8. åˆ°è¾¾ç»ˆç‚¹æ—¶å¹¿æ’­ `status_update` äº‹ä»¶é€šçŸ¥å·²é€è¾¾ã€‚

## 5. æ ¸å¿ƒåŠŸèƒ½ä¸ä¸šåŠ¡é—­ç¯
> ğŸ’¡ **æ ¸å¿ƒé—­ç¯ï¼š** å•†å®¶åˆ›å»ºè®¢å• -> æ¨¡æ‹Ÿå‘è´§ -> åç«¯ç”Ÿæˆè½¨è¿¹ -> ç”¨æˆ·å®æ—¶è¿½è¸ª -> ç¡®è®¤æ”¶è´§

### 5.1 å•†å®¶ç«¯
*   **æ•°æ®çœ‹æ¿ (`/merchant/dashboard`)**ï¼š
    *   **ç»Ÿè®¡å¡ç‰‡åŒº**ï¼šä»Šæ—¥è®¢å•æ•°ã€è¿è¾“ä¸­è®¢å•æ•°ï¼ˆWebSocket å®æ—¶æ›´æ–°ï¼‰ã€å·²å®Œæˆæ•°ã€ä»Šæ—¥é‡‘é¢ï¼ˆ30ç§’è½®è¯¢ï¼‰
    *   **é…é€æ—¶æ•ˆåˆ†æå›¾è¡¨**ï¼š
        *   å·¦ä¾§ï¼šECharts Geo åœ°ç†æŸ±çŠ¶å›¾ï¼ˆæŒ‰é…é€åŒºåŸŸç»Ÿè®¡è®¢å•æ•°/å¹³å‡é…é€æ—¶é•¿ï¼Œå¯åˆ‡æ¢ï¼‰
        *   å³ä¾§ï¼šæ™®é€šæŸ±çŠ¶å›¾ï¼ˆæŒ‰ç‰©æµå…¬å¸å¯¹æ¯”é…é€æ—¶æ•ˆï¼‰
    *   **è®¢å•ç›®çš„åœ°çƒ­åŠ›å›¾**ï¼šåŸºäºå†å²è®¢å•ç›®çš„åœ°åˆ†å¸ƒ
    *   **æœ€æ–°è®¢å•åŠ¨æ€åˆ—è¡¨**ï¼šå®æ—¶æ˜¾ç¤ºè®¢å•çŠ¶æ€å˜æ›´ï¼ˆå¦‚ï¼š"è®¢å• ORD123 å·²é€è¾¾"ï¼‰
    *   æ”¯æŒåˆ‡æ¢æ—¥æœŸèŒƒå›´ï¼ˆæ‰‹åŠ¨åˆ·æ–°ï¼‰
*   **è®¢å•ç®¡ç† (`/merchant/orders`)**ï¼š
    *   **åˆ—è¡¨å±•ç¤º**ï¼š
        *   åˆ†é¡µæ˜¾ç¤ºï¼Œæ¯é¡µæ¡æ•°å¯é€‰ï¼ˆ10/20/50/100ï¼Œé»˜è®¤100ï¼‰
        *   æ”¯æŒæŒ‰çŠ¶æ€ç­›é€‰ã€æŒ‰åˆ›å»ºæ—¶é—´/é‡‘é¢æ’åº
        *   å¤é€‰æ¡†å¤šé€‰ï¼ˆæ”¯æŒå…¨é€‰/åé€‰ï¼‰
        *   åˆ—è¡¨å·¦ä¾§æ˜¾ç¤ºåœ°å›¾ç»„ä»¶ï¼Œå®æ—¶æ˜¾ç¤ºé€‰ä¸­è®¢å•çš„ç»ˆç‚¹æ ‡è®°ã€è·¯å¾„çº¿ã€å½“å‰ä½ç½®ï¼ˆè¿è¾“ä¸­ï¼‰
        *   ä¸åŒçŠ¶æ€ç”¨ä¸åŒé¢œè‰²åŒºåˆ†ï¼ˆå¾…å‘è´§=ç°è‰²ã€è¿è¾“ä¸­=è“è‰²ã€å·²é€è¾¾=ç»¿è‰²ï¼‰
        *   ç‚¹å‡»åœ°å›¾æ ‡è®°æˆ–åŒå‡»åˆ—è¡¨è¡Œå¼¹å‡ºè®¢å•ä¿¡æ¯å¼¹çª—
    *   **æ‰¹é‡æ“ä½œ**ï¼š
        *   æ‰¹é‡å‘è´§ï¼šä»…é’ˆå¯¹å¾…å‘è´§è®¢å•ï¼ŒModal ç¡®è®¤åä¾æ¬¡è°ƒç”¨å‘è´§æ¥å£
        *   æ‰¹é‡åˆ é™¤ï¼šä»…å…è®¸åˆ é™¤å¾…å‘è´§/å·²å–æ¶ˆè®¢å•ï¼ŒModal ç¡®è®¤ååˆ é™¤
        *   æ‰¹é‡å¯¼å‡ºï¼šå¯¼å‡ºé€‰ä¸­è®¢å•ä¸º CSV æ–‡ä»¶
    *   **CSV å¯¼å‡º**ï¼šåŒ…å«å­—æ®µï¼ˆè®¢å•å·ã€çŠ¶æ€ã€åˆ›å»ºæ—¶é—´ã€ç‰©æµå…¬å¸ã€æ”¶è´§äººã€æ”¶è´§ç”µè¯ã€æ”¶è´§åœ°å€ã€å•†å“åç§°ã€æ•°é‡ã€é‡‘é¢ã€é¢„è®¡é€è¾¾ã€å®é™…é€è¾¾ï¼‰
*   **åˆ›å»ºè®¢å• (`/merchant/orders/new`)**ï¼š
    *   **å¿…å¡«å­—æ®µ**ï¼š
        *   ç‰©æµå…¬å¸ï¼ˆä¸‹æ‹‰é€‰æ‹©ï¼Œç³»ç»Ÿé¢„ç½® 6 å®¶ï¼‰
        *   æ”¶è´§åœ°å€ï¼ˆæ”¯æŒè¾“å…¥æ¡†æœç´¢ + åœ°å›¾é€‰ç‚¹ä¸¤ç§æ–¹å¼ï¼‰
        *   æ”¶è´§äººå§“åã€æ”¶è´§äººç”µè¯
        *   å•†å“åç§°ã€å•†å“æ•°é‡ã€è®¢å•é‡‘é¢
    *   **èµ·ç‚¹ä½ç½®**ï¼šè‡ªåŠ¨ä½¿ç”¨å•†å®¶é»˜è®¤å‘è´§åœ°å€ï¼ˆå­˜å‚¨åœ¨ Merchant è¡¨ï¼‰
    *   **é¢„è®¡é€è¾¾æ—¶é—´**ï¼šæ ¹æ®ç‰©æµå…¬å¸çš„æ ‡å‡†æ—¶æ•ˆè‡ªåŠ¨è®¡ç®—
*   **è®¢å•è¯¦æƒ…å¼¹çª—**ï¼š
    *   æ˜¾ç¤ºï¼šçŠ¶æ€ã€è¿›åº¦ç™¾åˆ†æ¯”ã€ç‰©æµå…¬å¸ã€æ”¶è´§äººï¼ˆè„±æ•ï¼‰ã€æ”¶è´§åœ°å€ã€å•†å“ä¿¡æ¯ã€é‡‘é¢ã€é¢„è®¡é€è¾¾æ—¶é—´
    *   æ“ä½œæŒ‰é’®ï¼š[æŸ¥çœ‹è¯¦æƒ…] [æ¨¡æ‹Ÿå‘è´§/å–æ¶ˆå‘è´§]
    *   æ”¯æŒç”Ÿæˆè®¢å•äºŒç»´ç ï¼ˆåŒ…å« `/track/:orderNo` é“¾æ¥ï¼‰
*   **é…é€åŒºåŸŸç®¡ç† (`/merchant/zones`)**ï¼š
    *   ä½¿ç”¨é«˜å¾·åœ°å›¾ `AMap.PolygonEditor` ç»˜åˆ¶å¤šè¾¹å½¢åŒºåŸŸ
    *   ç‚¹å‡»åœ°å›¾æ·»åŠ é¡¶ç‚¹ï¼ŒåŒå‡»å®Œæˆç»˜åˆ¶
    *   æ‹–æ‹½é¡¶ç‚¹ç¼–è¾‘å½¢çŠ¶ï¼Œå³é”®åˆ é™¤é¡¶ç‚¹
    *   é…ç½®åŒºåŸŸåç§°ã€é…é€æ—¶æ•ˆï¼ˆå°æ—¶ï¼‰
    *   åˆ—è¡¨å±•ç¤ºæ‰€æœ‰é…é€åŒºåŸŸï¼Œæ”¯æŒç¼–è¾‘/åˆ é™¤

### 5.2 ç”¨æˆ·ç«¯
*   **ç‰©æµæŸ¥è¯¢é¡µ (`/track`)**ï¼š
    *   è¾“å…¥æ¡†è¾“å…¥è®¢å•å·ï¼ˆæ ¼å¼ï¼š`ORD` å¼€å¤´ 20 ä½å­—ç¬¦ï¼‰
    *   æ”¯æŒæ ¼å¼éªŒè¯å’Œå‹å¥½æç¤º
    *   æ”¯æŒæ‰«æäºŒç»´ç è·³è½¬ï¼ˆæ— éœ€å‰ç«¯å®ç°æ‰«æåŠŸèƒ½ï¼‰
    *   èƒŒæ™¯åœ°å›¾æ˜¾ç¤ºé»˜è®¤ä½ç½®ï¼ˆåŒ—äº¬å¤©å®‰é—¨ï¼Œç¼©æ”¾çº§åˆ« 10ï¼‰
*   **å®æ—¶è¿½è¸ªé¡µ (`/track/:orderNo`)**ï¼š
    *   **åœ°å›¾å¯è§†åŒ–**ï¼š
        *   è°ƒç”¨ `/tracking/:orderNo` API è·å–è®¢å•å’Œå®Œæ•´è·¯å¾„ç‚¹æ•°ç»„ï¼ˆ`route.points`ï¼‰
        *   ç»˜åˆ¶èµ·ç‚¹æ ‡è®°ï¼ˆå•†å®¶ä½ç½®ï¼‰ã€ç»ˆç‚¹æ ‡è®°ï¼ˆæ”¶è´§åœ°å€ï¼‰
        *   ç»˜åˆ¶å®Œæ•´è·¯å¾„çº¿ï¼ˆè“è‰² Polylineï¼Œå¯é€‰ä¼˜åŒ–ï¼šå·²èµ°è¿‡æ·±è“å®çº¿ + æœªèµ°è¿‡æµ…ç°è™šçº¿ï¼‰
        *   è½¦è¾†å›¾æ ‡æ˜¾ç¤ºå½“å‰ä½ç½®ï¼ˆè¿è¾“ä¸­è®¢å•ï¼‰
        *   è‡ªåŠ¨è°ƒæ•´åœ°å›¾è§†é‡ä»¥æ˜¾ç¤ºèµ·ç‚¹å’Œç»ˆç‚¹ï¼ˆ`fitBounds`ï¼‰ï¼Œå¤±è´¥åˆ™å›é€€è‡³ç¼©æ”¾çº§åˆ« 10
        *   æ”¯æŒåœ°å›¾æ§ä»¶ï¼ˆç¼©æ”¾ã€å®šä½ã€æ¯”ä¾‹å°ºï¼‰ã€è§¦æ‘¸æ‰‹åŠ¿ï¼ˆåŒæŒ‡ç¼©æ”¾ã€æ‹–æ‹½ï¼‰
    *   **å®æ—¶ä½ç½®æ›´æ–°**ï¼š
        *   WebSocket è¿æ¥è®¢é˜…è®¢å•å·ï¼ˆå‘é€ `subscribe` äº‹ä»¶ï¼‰
        *   åç«¯æ¯ 5 ç§’æ¨é€ä¸€æ¬¡ä½ç½®æ›´æ–°ï¼ˆ`location_update` äº‹ä»¶ï¼‰
        *   å‰ç«¯æ”¶åˆ°æ¨é€åï¼Œè½¦è¾†å›¾æ ‡ä½¿ç”¨ç¼“åŠ¨å‡½æ•°åœ¨ 2 ç§’å†…å¹³æ»‘ç§»åŠ¨åˆ°æ–°ä½ç½®
        *   ç§»åŠ¨è·¯å¾„ä¸ºæ²¿è·¯å¾„çº¿çš„æ›²çº¿æ’å€¼ï¼ˆä½¿ç”¨é«˜å¾·åœ°å›¾ `Marker.moveAlong` APIï¼‰
        *   åˆ°è¾¾ç»ˆç‚¹æ—¶æ”¶åˆ° `status_update` äº‹ä»¶ï¼Œæ˜¾ç¤º"å·²é€è¾¾"
    *   **è®¢å•ä¿¡æ¯å¡ç‰‡**ï¼š
        *   æ˜¾ç¤ºè®¢å•å·ã€çŠ¶æ€ã€è¿›åº¦ç™¾åˆ†æ¯”ã€ç‰©æµå…¬å¸ã€é¢„è®¡é€è¾¾æ—¶é—´
        *   å®æ—¶æ›´æ–°è¿›åº¦æ¡
    *   **ç‰©æµæ—¶é—´çº¿**ï¼ˆå°å±å¹•ä¸åœ°å›¾åˆ‡æ¢ Tab æ˜¾ç¤ºï¼‰ï¼š
        *   æ—¶é—´è½´å½¢å¼å±•ç¤ºçŠ¶æ€å˜æ›´å†å²
        *   æ¯æ¡è®°å½•åŒ…å«çŠ¶æ€ã€æè¿°ã€ä½ç½®ã€æ—¶é—´æˆ³
        *   å€’åºæ˜¾ç¤ºï¼ˆæœ€æ–°åœ¨ä¸Šï¼‰
    *   **é”™è¯¯å¤„ç†**ï¼š
        *   ç½‘ç»œæ–­å¼€ï¼šé¡¶éƒ¨æ˜¾ç¤ºé»„è‰²æç¤ºæ¡"è¿æ¥å·²æ–­å¼€ï¼Œæ­£åœ¨é‡è¿..."
        *   é‡è¿ç­–ç•¥ï¼šæŒ‡æ•°é€€é¿é‡è¿ï¼ˆ1æ¬¡ç«‹å³ã€2æ¬¡ç­‰2ç§’ã€3æ¬¡ç­‰4ç§’ã€4æ¬¡ç­‰8ç§’ï¼Œæœ€å¤š5æ¬¡ï¼‰
        *   é‡è¿æˆåŠŸï¼šç»¿è‰²æç¤º"è¿æ¥å·²æ¢å¤"ï¼Œè‡ªåŠ¨é‡æ–°è®¢é˜…è®¢å•ï¼Œè·³è½¬åˆ°æœ€æ–°ä½ç½®
        *   é‡è¿å¤±è´¥ï¼šæ˜¾ç¤º"è¿æ¥å¤±è´¥ï¼Œè¯·åˆ·æ–°é¡µé¢"
    *   **å“åº”å¼è®¾è®¡**ï¼š
        *   æœ€å°å®½åº¦ 375pxï¼ˆiPhone æ ‡å‡†ï¼‰
        *   å°å±å¹•ï¼šåœ°å›¾å’Œæ—¶é—´è½´ä½¿ç”¨ Tab åˆ‡æ¢
        *   å¤§å±å¹•ï¼šåœ°å›¾å’Œæ—¶é—´è½´å·¦å³å¹¶æ’æ˜¾ç¤º
        *   æ”¯æŒæ¨ªç«–å±è‡ªé€‚åº”

### 5.3 åç«¯æœåŠ¡
*   **RESTful API**ï¼š
    *   è®¤è¯æ¥å£ï¼š`POST /auth/login`, `POST /auth/register`
    *   å•†å®¶æ¥å£ï¼š`GET /merchants/me` (éœ€è®¤è¯)
    *   è®¢å•æ¥å£ï¼š`GET /orders`, `POST /orders`, `GET /orders/:id`, `PATCH /orders/:id`, `DELETE /orders/:id`, `POST /orders/:id/ship` (éœ€è®¤è¯)
    *   é…é€åŒºåŸŸï¼š`GET /delivery-zones`, `POST /delivery-zones`, `PATCH /delivery-zones/:id`, `DELETE /delivery-zones/:id` (éœ€è®¤è¯)
    *   ç‰©æµå…¬å¸ï¼š`GET /logistics-companies` (å…¬å¼€ï¼Œå‰ç«¯ä¸‹æ‹‰é€‰æ‹©)
    *   è¿½è¸ªæ¥å£ï¼š`GET /tracking/:orderNo` (å…¬å¼€ï¼Œè¿”å›åŒ…å« `route.points` å®Œæ•´è·¯å¾„)
*   **WebSocket å®æ—¶é€šä¿¡**ï¼š
    *   ä½¿ç”¨ Socket.io Gateway å®ç° (ç«¯å£ä¸ HTTP æœåŠ¡ç›¸åŒ)
    *   å®¢æˆ·ç«¯äº‹ä»¶ï¼š`subscribe(orderNo)` è®¢é˜…è®¢å•ï¼Œ`unsubscribe(orderNo)` å–æ¶ˆè®¢é˜…
    *   æœåŠ¡ç«¯äº‹ä»¶ï¼š`location_update` ä½ç½®æ›´æ–°ï¼Œ`status_update` çŠ¶æ€æ›´æ–°
    *   Room æœºåˆ¶å®ç°è®¢å•çº§åˆ«éš”ç¦»ï¼Œé¿å…æ— æ•ˆæ¨é€
    *   é¦–æ¬¡è®¢é˜…ç«‹å³æ¨é€å½“å‰çŠ¶æ€ï¼ˆä½ç½®ã€è¿›åº¦ã€é¢„è®¡é€è¾¾ï¼‰
*   **è½¨è¿¹æ¨¡æ‹Ÿ**ï¼š
    *   ä½¿ç”¨ `@nestjs/schedule` å®ç° Cron å®šæ—¶ä»»åŠ¡ï¼ˆæ¯ 5 ç§’æ‰§è¡Œï¼‰
    *   è‡ªåŠ¨æ›´æ–°è¿è¾“ä¸­è®¢å•çš„ä½ç½®ï¼Œæ¨è¿›è·¯å¾„æ­¥éª¤ï¼ˆ`currentStep++`ï¼‰
    *   é€šè¿‡ WebSocket å¹¿æ’­ `location_update` äº‹ä»¶åˆ°å¯¹åº”è®¢å• Room
    *   åˆ°è¾¾ç»ˆç‚¹è‡ªåŠ¨æ ‡è®°ä¸ºå·²é€è¾¾ï¼Œåˆ›å»ºæ—¶é—´çº¿è®°å½•ï¼Œå¹¿æ’­ `status_update` äº‹ä»¶
    *   æœåŠ¡é‡å¯åè‡ªåŠ¨æ¢å¤æ‰€æœ‰è¿è¾“ä¸­è®¢å•çš„æ¨¡æ‹Ÿ

### 5.4 å…³é”®ä¸šåŠ¡é€»è¾‘å®ç°
*   **è½¨è¿¹æ¨¡æ‹Ÿç­–ç•¥**:
    1.  **ä¼˜å…ˆçœŸå®è·¯ç½‘**: 
        *   è°ƒç”¨é«˜å¾·åœ°å›¾ Web æœåŠ¡ API (`/v3/direction/driving`)ã€‚
        *   æå– polyline è·¯å¾„ç‚¹ï¼Œè¿›è¡Œé‡‡æ ·ä¼˜åŒ–ï¼ˆä¿ç•™ 50 ä¸ªå…³é”®ç‚¹ï¼‰ã€‚
        *   çœŸå®è·¯ç½‘è·¯å¾„é€šå¸¸åŒ…å« 50+ ä¸ªä¸è§„åˆ™è·¯å¾„ç‚¹ã€‚
    2.  **é™çº§ç­–ç•¥**: 
        *   è‹¥ API è°ƒç”¨å¤±è´¥ï¼ˆç½‘ç»œé”™è¯¯ã€Key æ— æ•ˆç­‰ï¼‰ï¼Œè‡ªåŠ¨åˆ‡æ¢åˆ°ç›´çº¿æ’å€¼ã€‚
        *   åœ¨èµ·ç‚¹å’Œç»ˆç‚¹é—´ç”Ÿæˆ 20 ä¸ªå‡åŒ€åˆ†å¸ƒçš„è·¯å¾„ç‚¹ã€‚
        *   ç¡®ä¿ç³»ç»Ÿåœ¨ä»»ä½•æƒ…å†µä¸‹éƒ½èƒ½æ­£å¸¸å·¥ä½œã€‚
    3.  **çŠ¶æ€åŒæ­¥**: 
        *   Route è¡¨ç»´æŠ¤ `currentStep` æŒ‡é’ˆå’Œ `totalSteps` æ€»æ•°ã€‚
        *   WebSocket è®¢é˜…æ—¶ç«‹å³å‘é€å½“å‰ä½ç½®å’Œè¿›åº¦ã€‚
        *   Cron ä»»åŠ¡æ¯ 5 ç§’æ¨è¿›ä¸€æ­¥ï¼Œå¹¿æ’­ä½ç½®æ›´æ–°ã€‚
    4.  **è‡ªåŠ¨å®Œæˆé…é€**:
        *   åˆ°è¾¾ç»ˆç‚¹ï¼ˆ`currentStep >= totalSteps - 1`ï¼‰æ—¶è‡ªåŠ¨æ›´æ–°è®¢å•çŠ¶æ€ä¸º DELIVEREDã€‚
        *   åˆ›å»º"å·²ç­¾æ”¶"ç‰©æµæ—¶é—´çº¿è®°å½•ã€‚
        *   åœæ­¢ç»§ç»­æ¨é€ã€‚
*   **é…é€åŒºåŸŸç®¡ç†**:
    *   å•†å®¶ç»˜åˆ¶å¤šè¾¹å½¢åŒºåŸŸï¼ˆGeoJSON Polygon æ ¼å¼ï¼‰ã€‚
    *   åç«¯ä½¿ç”¨**å°„çº¿æ³•ç®—æ³•**ï¼ˆRay Casting Algorithmï¼‰åˆ¤æ–­è®¢å•ç›®çš„åœ°æ˜¯å¦åœ¨åŒºåŸŸå†…ã€‚
    *   æ”¯æŒ Haversine å…¬å¼è®¡ç®—åœ°ç†è·ç¦»ã€‚
*   **ç‰©æµå…¬å¸æ—¶æ•ˆç®¡ç†**ï¼ˆéœ€æ–°å¢åŠŸèƒ½ï¼‰:
    *   æ–°å¢ `LogisticsCompany` è¡¨ï¼Œå­˜å‚¨ç‰©æµå…¬å¸é…ç½®ï¼š
        *   `id` (UUID), `name` (å”¯ä¸€ï¼Œå¦‚"é¡ºä¸°é€Ÿè¿"), `timeLimit` (é…é€æ—¶æ•ˆï¼Œå°æ—¶)
        *   ç³»ç»Ÿé¢„ç½® 6 å®¶ç‰©æµå…¬å¸ï¼š
            *   é¡ºä¸°é€Ÿè¿ (24å°æ—¶)ã€äº¬ä¸œç‰©æµ (24å°æ—¶)
            *   åœ†é€šé€Ÿé€’ (48å°æ—¶)ã€ä¸­é€šå¿«é€’ (48å°æ—¶)
            *   ç”³é€šå¿«é€’ (72å°æ—¶)ã€éŸµè¾¾é€Ÿé€’ (72å°æ—¶)
    *   åˆ›å»ºè®¢å•æ—¶æ ¹æ®é€‰æ‹©çš„ç‰©æµå…¬å¸è‡ªåŠ¨è®¡ç®— `estimatedTime`ï¼š
        *   `estimatedTime = createdAt + timeLimit`
    *   æä¾› `GET /logistics-companies` æ¥å£ä¾›å‰ç«¯è·å–ç‰©æµå…¬å¸åˆ—è¡¨
*   **å•†å®¶å‘è´§åœ°å€ç®¡ç†**ï¼ˆéœ€æ–°å¢åŠŸèƒ½ï¼‰:
    *   `Merchant` è¡¨æ–°å¢å­—æ®µï¼š`address` (JSON: {lng, lat, address})
    *   å•†å®¶é¦–æ¬¡ç™»å½•æˆ–åœ¨è®¾ç½®é¡µé…ç½®é»˜è®¤å‘è´§åœ°å€
    *   åˆ›å»ºè®¢å•æ—¶è‡ªåŠ¨ä½¿ç”¨å•†å®¶çš„ `address` ä½œä¸º `origin`
*   **æ•°æ®ç”Ÿæˆå™¨ (Seeder)**:
    *   é¢„ç½® 5 ä¸ªæ¨¡æ‹Ÿè®¢å•å’Œ 1 ä¸ªè¿è¾“ä¸­è®¢å•ï¼Œåˆ†å¸ƒåœ¨åŒ—äº¬å¸‚ï¼Œæ–¹ä¾¿æ¼”ç¤º
    *   é¢„ç½® 2 ä¸ªé…é€åŒºåŸŸï¼ˆåŒ—äº¬å¸‚ä¸­å¿ƒï¼‰
    *   é¢„ç½® 6 å®¶ç‰©æµå…¬å¸é…ç½®
    *   é¢„ç½®å•†å®¶é»˜è®¤å‘è´§åœ°å€ï¼ˆåŒ—äº¬å¸‚æœé˜³åŒºï¼‰
*   **è®¤è¯ä¸æˆæƒ**:
    *   ä½¿ç”¨ Passport Local Strategy å¤„ç†ç™»å½•
    *   JWT Token æ— çŠ¶æ€è®¤è¯ï¼Œä¿æŠ¤å•†å®¶ç«¯æ¥å£
    *   ç”¨æˆ·ç«¯è¿½è¸ªæ¥å£å…¬å¼€ï¼Œæ— éœ€è®¤è¯ï¼ˆä»…éœ€è®¢å•å·ï¼‰

## 6. æ•°æ®åº“è®¾è®¡æ¦‚è¦ (Schema Plan)
*   **Merchant (å•†å®¶)**: 
    *   æ ¸å¿ƒå­—æ®µï¼š`id` (UUID), `username` (å”¯ä¸€), `passwordHash` (bcrypt), `name`, `phone`
    *   **æ–°å¢å­—æ®µ**ï¼š`address` (JSON: {lng, lat, address}) - é»˜è®¤å‘è´§åœ°å€
    *   å…³ç³»ï¼šä¸€å¯¹å¤š orders, ä¸€å¯¹å¤š deliveryZones
*   **Order (è®¢å•)**: 
    *   æ ¸å¿ƒå­—æ®µï¼š`id` (UUID), `orderNo` (å”¯ä¸€), `status` (enum: PENDING, SHIPPING, DELIVERED, CANCELLED), `merchantId`
    *   æ”¶è´§ä¿¡æ¯ï¼š`receiverName`, `receiverPhone`, `receiverAddress`
    *   å•†å“ä¿¡æ¯ï¼š`productName`, `productQuantity`, `amount`, `logistics`
    *   åœ°ç†ä½ç½®ï¼š`origin` (JSON: {lng, lat, address}), `destination` (JSON), `currentLocation` (JSON)
    *   æ—¶æ•ˆï¼š`estimatedTime`, `actualTime`
    *   å…³ç³»ï¼šå¤šå¯¹ä¸€ merchant, ä¸€å¯¹ä¸€ route, ä¸€å¯¹å¤š timeline
*   **DeliveryZone (é…é€åŒºåŸŸ)**: 
    *   æ ¸å¿ƒå­—æ®µï¼š`id` (UUID), `name`, `merchantId`, `boundary` (GeoJSON Polygon), `timeLimit` (å°æ—¶)
    *   å…³ç³»ï¼šå¤šå¯¹ä¸€ merchant
*   **Route (è½¨è¿¹ç¼“å­˜)**: 
    *   æ ¸å¿ƒå­—æ®µï¼š`id` (UUID), `orderId` (å”¯ä¸€), `points` (JSON æ•°ç»„: [[lng, lat], ...])
    *   è¿›åº¦ï¼š`currentStep` (å½“å‰æ­¥éª¤ç´¢å¼•), `totalSteps` (æ€»æ­¥æ•°), `interval` (æ¯«ç§’)
    *   å…³ç³»ï¼šä¸€å¯¹ä¸€ order
*   **LogisticsTimeline (ç‰©æµæ—¶é—´çº¿)**: 
    *   æ ¸å¿ƒå­—æ®µï¼š`id` (UUID), `orderId`, `status` (çŠ¶æ€æè¿°), `description` (è¯¦ç»†è¯´æ˜)
    *   ä½ç½®ï¼š`location` (å¯é€‰), `timestamp`
    *   å…³ç³»ï¼šå¤šå¯¹ä¸€ order
*   **LogisticsCompany (ç‰©æµå…¬å¸)** - **æ–°å¢è¡¨**:
    *   æ ¸å¿ƒå­—æ®µï¼š`id` (UUID), `name` (å”¯ä¸€ï¼Œç‰©æµå…¬å¸åç§°), `timeLimit` (é…é€æ—¶æ•ˆï¼Œå°æ—¶)
    *   é¢„ç½®æ•°æ®ï¼šé¡ºä¸°é€Ÿè¿(24h)ã€äº¬ä¸œç‰©æµ(24h)ã€åœ†é€šé€Ÿé€’(48h)ã€ä¸­é€šå¿«é€’(48h)ã€ç”³é€šå¿«é€’(72h)ã€éŸµè¾¾é€Ÿé€’(72h)

## 7. ç”¨æˆ·ä½“éªŒä¸æŠ€æœ¯ç‰¹è‰²

### 7.1 å·²å®ç°ç‰¹æ€§
*   **å®æ—¶æ•°æ®åŒæ­¥**: 
    *   WebSocket Room æœºåˆ¶å®ç°è®¢å•çº§åˆ«éš”ç¦»ã€‚
    *   æ”¯æŒè®¢é˜…/å–æ¶ˆè®¢é˜…ï¼Œé¿å…æ— æ•ˆæ¨é€ã€‚
    *   é¦–æ¬¡è®¢é˜…ç«‹å³æ¨é€å½“å‰çŠ¶æ€ï¼Œæ— éœ€ç­‰å¾…ä¸‹ä¸€ä¸ª tickã€‚
*   **æ™ºèƒ½é™çº§ç­–ç•¥**: 
    *   é«˜å¾· API ä¸å¯ç”¨æ—¶è‡ªåŠ¨åˆ‡æ¢åˆ°ç›´çº¿æ’å€¼ã€‚
    *   ä¿è¯ç³»ç»Ÿåœ¨ä»»ä½•æƒ…å†µä¸‹éƒ½èƒ½æä¾›å®Œæ•´åŠŸèƒ½ã€‚
*   **æ•°æ®æŒä¹…åŒ–**: 
    *   è·¯å¾„ç¼“å­˜åœ¨æ•°æ®åº“ä¸­ï¼Œé¿å…é‡å¤è®¡ç®—ã€‚
    *   æœåŠ¡é‡å¯åè‡ªåŠ¨æ¢å¤æ‰€æœ‰è¿è¾“ä¸­è®¢å•ã€‚
*   **å®Œæ•´ä¸šåŠ¡é—­ç¯**: 
    *   ä»è®¢å•åˆ›å»º â†’ å‘è´§ â†’ è¿è¾“ â†’ é€è¾¾çš„å…¨æµç¨‹è‡ªåŠ¨åŒ–ã€‚
    *   ç‰©æµæ—¶é—´çº¿è‡ªåŠ¨è®°å½•å…³é”®èŠ‚ç‚¹ã€‚

### 7.2 å‰ç«¯å¼€å‘è®¡åˆ’
**æ ¸å¿ƒåŠŸèƒ½**ï¼ˆå¿…é¡»å®ç°ï¼‰ï¼š
*   âœ… å•†å®¶ç«¯ç™»å½•/æ³¨å†Œé¡µé¢ï¼ˆJWT è®¤è¯ï¼‰
*   âœ… è®¢å•åˆ—è¡¨é¡µï¼ˆåˆ†é¡µã€ç­›é€‰ã€æ’åºã€å¤šé€‰ï¼‰
*   âœ… åˆ›å»ºè®¢å•è¡¨å•ï¼ˆåœ°å›¾é€‰ç‚¹ + åœ°å€æœç´¢ï¼‰
*   âœ… é…é€åŒºåŸŸç®¡ç†ï¼ˆå¤šè¾¹å½¢ç»˜åˆ¶ç¼–è¾‘ï¼‰
*   âœ… ç”¨æˆ·ç«¯ç‰©æµæŸ¥è¯¢é¡µï¼ˆè®¢å•å·è¾“å…¥ï¼‰
*   âœ… å®æ—¶è¿½è¸ªé¡µï¼ˆWebSocket + åœ°å›¾åŠ¨ç”»ï¼‰
*   âœ… ç‰©æµæ—¶é—´è½´ç»„ä»¶
*   âœ… å“åº”å¼å¸ƒå±€ï¼ˆæœ€å° 375pxï¼‰

**è¿›é˜¶åŠŸèƒ½**ï¼ˆæ¨èå®ç°ï¼‰ï¼š
*   âœ… æ•°æ®çœ‹æ¿ï¼ˆç»Ÿè®¡å¡ç‰‡ + ECharts å›¾è¡¨ï¼‰
*   âœ… æ‰¹é‡æ“ä½œï¼ˆå‘è´§ã€åˆ é™¤ã€å¯¼å‡º CSVï¼‰
*   âœ… è®¢å•äºŒç»´ç ç”Ÿæˆ
*   âœ… ä¸»é¢˜åˆ‡æ¢ï¼ˆæ·±è‰²/æµ…è‰²ï¼Œä¼šè¯çº§ï¼‰
*   âœ… WebSocket æ–­çº¿é‡è¿ï¼ˆæŒ‡æ•°é€€é¿ï¼‰
*   âœ… éª¨æ¶å±åŠ è½½çŠ¶æ€

**ä¼˜åŒ–åŠŸèƒ½**ï¼ˆå¯é€‰å®ç°ï¼‰ï¼š
*   â­• åœ°å›¾è·¯å¾„åˆ†æ®µæ˜¾ç¤ºï¼ˆå·²èµ°è¿‡æ·±è“å®çº¿ + æœªèµ°è¿‡æµ…ç°è™šçº¿ï¼‰
*   â­• åœ°å›¾æ€§èƒ½ä¼˜åŒ–ï¼ˆå¤§é‡è®¢å•æ—¶ä½¿ç”¨èšåˆæ ‡è®°ï¼‰
*   â­• è®¢å•åˆ—è¡¨è™šæ‹Ÿæ»šåŠ¨ï¼ˆå¤„ç† 300+ è®¢å•ï¼‰
*   â­• å‰ç«¯å•å…ƒæµ‹è¯• / E2E æµ‹è¯•

## 8. é¡¹ç›®å®æ–½çŠ¶æ€

### 8.1 åç«¯æœåŠ¡
**âœ… å…¨éƒ¨åŠŸèƒ½å·²å®Œæˆå¹¶æµ‹è¯•é€šè¿‡**ï¼š
*   âœ… å•†å®¶è®¤è¯ç³»ç»Ÿï¼ˆJWT + Passportï¼‰
*   âœ… è®¢å•ç®¡ç†å®Œæ•´ CRUDï¼ˆå«æ‰¹é‡å‘è´§/åˆ é™¤ï¼‰
*   âœ… æ™ºèƒ½è·¯å¾„è§„åˆ’ï¼ˆé«˜å¾· API + é™çº§ç­–ç•¥ï¼‰
*   âœ… å®æ—¶è½¨è¿¹è¿½è¸ªï¼ˆWebSocketï¼Œå« Room æœºåˆ¶å’Œ delivery_complete äº‹ä»¶ï¼‰
*   âœ… é…é€åŒºåŸŸç®¡ç†ï¼ˆå°„çº¿æ³•åœ°ç†è®¡ç®—ï¼‰
*   âœ… å®šæ—¶ä»»åŠ¡è‡ªåŠ¨åŒ–ï¼ˆCron è½¨è¿¹æ¨¡æ‹Ÿï¼‰
*   âœ… ç‰©æµæ—¶é—´çº¿è‡ªåŠ¨è®°å½•
*   âœ… ç‰©æµå…¬å¸ç®¡ç†ç³»ç»Ÿï¼ˆ6å®¶é¢„ç½®å…¬å¸ï¼Œè‡ªåŠ¨è®¡ç®—æ—¶æ•ˆï¼‰
*   âœ… å•†å®¶å‘è´§åœ°å€ç®¡ç†ï¼ˆæ”¯æŒæ›´æ–°å’Œè‡ªåŠ¨ä½¿ç”¨ï¼‰
*   âœ… æ•°æ®ç»Ÿè®¡åˆ†æï¼ˆæ€»è§ˆ/åŒºåŸŸ/ç‰©æµå…¬å¸ï¼‰
*   âœ… æ•°æ®åº“è®¾è®¡ä¸ Prisma ORM
*   âœ… å®Œæ•´çš„æµ‹è¯•å¥—ä»¶ï¼ˆå•å…ƒæµ‹è¯• + E2Eæµ‹è¯• + æ¼”ç¤ºæµ‹è¯•ï¼‰
*   âœ… Docker å®¹å™¨åŒ–æ”¯æŒ

**æµ‹è¯•éªŒè¯ç»“æœ**ï¼ˆ2025-11-23ï¼‰ï¼š
- âœ… **å•å…ƒæµ‹è¯•**: 66/66 é€šè¿‡ï¼ˆAmapService, GeoUtils, OrdersServiceï¼‰
- âœ… **E2E æµ‹è¯•**: 42/42 é€šè¿‡ï¼ˆ11ä¸ªä¸šåŠ¡åœºæ™¯å…¨è¦†ç›–ï¼‰
- âœ… **æ¼”ç¤ºæµ‹è¯•**: 9/9 åœºæ™¯é€šè¿‡ï¼ˆ55ç§’å®Œæ•´æ¼”ç¤ºï¼‰
- âœ… **é«˜å¾· API**: çœŸå®è·¯ç½‘è§„åˆ’æˆåŠŸï¼ˆå¤©å®‰é—¨â†’æœ›äº¬ï¼Œ57ä¸ªè·¯å¾„ç‚¹ï¼‰
- âœ… **WebSocket**: å®æ—¶æ¨é€æ­£å¸¸ï¼ˆå«æ–­çº¿é‡è¿å’Œäº‹ä»¶å®Œæ•´æ€§ï¼‰
- âœ… **ç³»ç»ŸçŠ¶æ€**: 118ä¸ªè®¢å•ï¼Œ7ä¸ªè¿è¾“ä¸­ï¼Œä»Šæ—¥56å•ï¼Œé‡‘é¢Â¥245,162.93
- âœ… **æœåŠ¡æ¢å¤**: æ”¯æŒé‡å¯åè‡ªåŠ¨æ¢å¤è¿è¾“ä¸­è®¢å•

**æµ‹è¯•ç»Ÿè®¡æ¦‚è§ˆ**ï¼š

| æµ‹è¯•ç±»å‹ | æ–‡ä»¶æ•° | æµ‹è¯•ç”¨ä¾‹ | é€šè¿‡ç‡ | è¦†ç›–ç‡ |
|---------|-------|---------|--------|--------|
| å•å…ƒæµ‹è¯• | 3 | 66ä¸ª | 100% âœ… | æ ¸å¿ƒæ¨¡å— 80%+ |
| E2E æµ‹è¯• | 1 | 42ä¸ª | 100% âœ… | å®Œæ•´ä¸šåŠ¡æµç¨‹ |
| æ¼”ç¤ºæµ‹è¯• | 2 | 9ä¸ªåœºæ™¯ | 100% âœ… | åŠŸèƒ½å±•ç¤º |

**æ¼”ç¤ºæ€§æµ‹è¯•**ï¼š

é¡¹ç›®åŒ…å«ä¸¤ç§æ¼”ç¤ºæ€§æµ‹è¯•ï¼Œç”¨äºå¿«é€Ÿå±•ç¤ºç³»ç»ŸåŠŸèƒ½ï¼š

1. **å®Œæ•´æµç¨‹æ¼”ç¤º** (`backend/tests/demo.test.ts`)
   - è¿è¡Œå‘½ä»¤ï¼š`pnpm demo`
   - è‡ªåŠ¨åŒ–æ‰§è¡Œå…¨æµç¨‹ï¼ˆçº¦ 60-90 ç§’ï¼‰
   - å±•ç¤º 9 å¤§æ ¸å¿ƒèƒ½åŠ› + 7 å¤§æŠ€æœ¯äº®ç‚¹
   - åŒ…å« WebSocket å®æ—¶æ¨é€æ¼”ç¤º

2. **äº¤äº’å¼æ¼”ç¤º** (`backend/tests/api-showcase.ts`)
   - è¿è¡Œå‘½ä»¤ï¼š`pnpm demo:interactive`
   - äº¤äº’å¼èœå•é€‰æ‹©ï¼ŒæŒ‰éœ€æ¼”ç¤ºç‰¹å®šåŠŸèƒ½
   - æ”¯æŒ 12 ä¸ªå¯é€‰åœºæ™¯ï¼ˆè®¤è¯ã€è®¢å•ã€è·¯å¾„è§„åˆ’ã€å®æ—¶è¿½è¸ªç­‰ï¼‰

è¯¦ç»†æµ‹è¯•æ–‡æ¡£è¯·å‚è€ƒ `docs/backend.md` ä¸­çš„"æµ‹è¯•ç­–ç•¥"ç« èŠ‚ã€‚

### 8.2 å‰ç«¯åº”ç”¨ (â³ å¾…å¼€å‘ - ä¸‹ä¸€æ­¥)

**å¼€å‘è·¯çº¿å›¾**ï¼ˆæ¨èé¡ºåºï¼‰ï¼š

**é˜¶æ®µ 1: é¡¹ç›®åˆå§‹åŒ–** (1-2å°æ—¶)
*   â³ åˆ›å»º Vite + React + TypeScript é¡¹ç›®
*   â³ å®‰è£…ä¾èµ–ï¼ˆAnt Design, é«˜å¾·åœ°å›¾, ECharts, axios, socket.io-client, zustand, react-router-dom, qrcode.reactï¼‰
*   â³ é…ç½®è·¯ç”±ï¼ˆReact Router v6ï¼‰
*   â³ é…ç½®ç¯å¢ƒå˜é‡ï¼ˆVITE_API_URL, VITE_AMAP_KEY, VITE_AMAP_SECURITY_JSCODEï¼‰
*   â³ åˆ›å»º API æœåŠ¡å°è£…ï¼ˆaxios instance + JWT æ‹¦æˆªå™¨ï¼‰

**é˜¶æ®µ 2: å•†å®¶ç«¯æ ¸å¿ƒåŠŸèƒ½** (4-6å°æ—¶)
*   â³ ç™»å½•é¡µ (`/merchant/login`) + JWT Token å­˜å‚¨
*   â³ è®¢å•åˆ—è¡¨é¡µ (`/merchant/orders`) - è¡¨æ ¼ + åˆ†é¡µ + ç­›é€‰ + å¤šé€‰
*   â³ åˆ›å»ºè®¢å•è¡¨å• (`/merchant/orders/new`) - åœ°å€æœç´¢ + åœ°å›¾é€‰ç‚¹
*   â³ è®¢å•è¯¦æƒ…å¼¹çª— - ä¿¡æ¯å±•ç¤º + äºŒç»´ç ç”Ÿæˆ
*   â³ æ‰¹é‡æ“ä½œ - å‘è´§/åˆ é™¤/å¯¼å‡ºCSV

**é˜¶æ®µ 3: åœ°å›¾åŠŸèƒ½** (3-4å°æ—¶)
*   â³ é«˜å¾·åœ°å›¾ç»„ä»¶å°è£…ï¼ˆåˆå§‹åŒ– + æ¸…ç†ï¼‰
*   â³ è®¢å•åˆ—è¡¨åœ°å›¾ - æ˜¾ç¤ºé€‰ä¸­è®¢å•çš„ç»ˆç‚¹ã€è·¯å¾„ã€å½“å‰ä½ç½®
*   â³ é…é€åŒºåŸŸç®¡ç† (`/merchant/zones`) - PolygonEditor ç»˜åˆ¶/ç¼–è¾‘
*   â³ åœ°å›¾æ§ä»¶é…ç½®ï¼ˆç¼©æ”¾ã€å®šä½ã€æ¯”ä¾‹å°ºï¼‰

**é˜¶æ®µ 4: æ•°æ®çœ‹æ¿** (2-3å°æ—¶)
*   â³ Dashboard (`/merchant/dashboard`) - ç»Ÿè®¡å¡ç‰‡ + è½®è¯¢æ›´æ–°
*   â³ ECharts å›¾è¡¨ - é…é€åŒºåŸŸåœ°ç†æŸ±çŠ¶å›¾
*   â³ ECharts å›¾è¡¨ - ç‰©æµå…¬å¸æŸ±çŠ¶å›¾
*   â³ è®¢å•ç›®çš„åœ°çƒ­åŠ›å›¾

**é˜¶æ®µ 5: ç”¨æˆ·ç«¯è¿½è¸ª** (3-4å°æ—¶)
*   â³ ç‰©æµæŸ¥è¯¢é¡µ (`/track`) - è®¢å•å·è¾“å…¥ + éªŒè¯
*   â³ å®æ—¶è¿½è¸ªé¡µ (`/track/:orderNo`) - åœ°å›¾ + ç‰©æµæ—¶é—´è½´
*   â³ WebSocket å®æ—¶é€šä¿¡ - è®¢é˜…/æ–­çº¿é‡è¿/ä½ç½®æ›´æ–°
*   â³ è½¦è¾†åŠ¨ç”» - Marker.moveAlong å¹³æ»‘ç§»åŠ¨
*   â³ å“åº”å¼å¸ƒå±€ - å°å±å¹• Tab åˆ‡æ¢ï¼Œå¤§å±å¹•å¹¶æ’æ˜¾ç¤º

**é˜¶æ®µ 6: ä¼˜åŒ–å’Œæµ‹è¯•** (2-3å°æ—¶)
*   â³ é”™è¯¯å¤„ç† - Toast/Modal æç¤º
*   â³ ä¸»é¢˜åˆ‡æ¢ - æ·±è‰²/æµ…è‰²æ¨¡å¼ï¼ˆä¼šè¯çº§ï¼‰
*   â³ éª¨æ¶å±åŠ è½½çŠ¶æ€
*   â³ æ‰‹åŠ¨åŠŸèƒ½æµ‹è¯•
*   â³ æ€§èƒ½ä¼˜åŒ–ï¼ˆæŒ‰éœ€ï¼‰

**å¾…å¼€å‘ç»„ä»¶åˆ—è¡¨**ï¼š
*   é€šç”¨ç»„ä»¶ï¼š
    *   `MapComponent` - é«˜å¾·åœ°å›¾å°è£…
    *   `OrderDetailModal` - è®¢å•è¯¦æƒ…å¼¹çª—
    *   `QRCodeGenerator` - äºŒç»´ç ç”Ÿæˆ
    *   `ThemeSwitch` - ä¸»é¢˜åˆ‡æ¢å¼€å…³
    *   `ErrorBoundary` - é”™è¯¯è¾¹ç•Œ
*   å•†å®¶ç«¯ç»„ä»¶ï¼š
    *   `LoginForm` - ç™»å½•è¡¨å•
    *   `OrderTable` - è®¢å•è¡¨æ ¼
    *   `OrderForm` - åˆ›å»ºè®¢å•è¡¨å•
    *   `AddressPicker` - åœ°å€é€‰æ‹©å™¨
    *   `ZoneEditor` - é…é€åŒºåŸŸç¼–è¾‘å™¨
    *   `Dashboard` - æ•°æ®çœ‹æ¿
    *   `StatisticsCard` - ç»Ÿè®¡å¡ç‰‡
    *   `TimeAnalysisChart` - æ—¶æ•ˆåˆ†æå›¾è¡¨
    *   `HeatmapChart` - çƒ­åŠ›å›¾
*   ç”¨æˆ·ç«¯ç»„ä»¶ï¼š
    *   `TrackingMap` - è¿½è¸ªåœ°å›¾
    *   `OrderTimeline` - ç‰©æµæ—¶é—´è½´
    *   `OrderInfoCard` - è®¢å•ä¿¡æ¯å¡ç‰‡
    *   `VehicleMarker` - è½¦è¾†æ ‡è®°
    *   `ConnectionStatus` - è¿æ¥çŠ¶æ€æç¤º

## 9. ç›®å½•ç»“æ„è§„èŒƒ
```
/
â”œâ”€â”€ frontend/             # React é¡¹ç›® (å¾…å¼€å‘)
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ pages/        # é¡µé¢ç»„ä»¶
â”‚   â”‚   â”‚   â”œâ”€â”€ merchant/ # å•†å®¶ç«¯é¡µé¢
â”‚   â”‚   â”‚   â””â”€â”€ track/    # ç”¨æˆ·ç«¯é¡µé¢
â”‚   â”‚   â”œâ”€â”€ components/   # é€šç”¨ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ stores/       # Zustand çŠ¶æ€ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ contexts/     # React Context
â”‚   â”‚   â”œâ”€â”€ services/     # API è¯·æ±‚å°è£…
â”‚   â”‚   â”œâ”€â”€ utils/        # å·¥å…·å‡½æ•°
â”‚   â”‚   â””â”€â”€ types/        # TypeScript ç±»å‹å®šä¹‰
â”‚   â”œâ”€â”€ public/           # é™æ€èµ„æº
â”‚   â””â”€â”€ package.json
â”œâ”€â”€ backend/              # NestJS é¡¹ç›® (å·²å®Œæˆ)
â”‚   â”œâ”€â”€ src/              # æºä»£ç 
â”‚   â”œâ”€â”€ prisma/           # æ•°æ®åº“ Schema å’Œ Seed
â”‚   â”œâ”€â”€ tests/            # å±•ç¤ºæ€§æµ‹è¯•
â”‚   â”œâ”€â”€ Dockerfile        # Docker é•œåƒ
â”‚   â””â”€â”€ .env              # ç¯å¢ƒå˜é‡
â”œâ”€â”€ docs/                 # é¡¹ç›®æ–‡æ¡£
â”œâ”€â”€ documents/            # åŸå§‹éœ€æ±‚æ–‡æ¡£
â”œâ”€â”€ docker-compose.yml    # æ•°æ®åº“ç¼–æ’
â””â”€â”€ README.md             # é¡¹ç›®å…¥å£è¯´æ˜
```

---

## 10. åç«¯ API æ¥å£æ¸…å•ï¼ˆå·²å…¨éƒ¨å®ç°ï¼‰

> âœ… æ‰€æœ‰åç«¯æ¥å£å·²å®ç°å¹¶æµ‹è¯•é€šè¿‡ï¼Œå‰ç«¯å¯ç›´æ¥è°ƒç”¨ã€‚

### 10.1 è®¤è¯æ¥å£
- âœ… `POST /auth/login` - å•†å®¶ç™»å½•ï¼ˆè¿”å› JWT Tokenï¼‰
- âœ… `POST /auth/register` - å•†å®¶æ³¨å†Œ

### 10.2 å•†å®¶æ¥å£
- âœ… `GET /merchants/me` - è·å–å•†å®¶ä¿¡æ¯ï¼ˆéœ€è®¤è¯ï¼‰
- âœ… `PATCH /merchants/me` - æ›´æ–°å•†å®¶ä¿¡æ¯ï¼ˆå«å‘è´§åœ°å€ï¼‰

### 10.3 è®¢å•æ¥å£
- âœ… `GET /orders` - è®¢å•åˆ—è¡¨ï¼ˆæ”¯æŒåˆ†é¡µã€ç­›é€‰ã€æ’åºï¼‰
- âœ… `POST /orders` - åˆ›å»ºè®¢å•ï¼ˆè‡ªåŠ¨ä½¿ç”¨å•†å®¶å‘è´§åœ°å€ï¼‰
- âœ… `GET /orders/:id` - è®¢å•è¯¦æƒ…
- âœ… `PATCH /orders/:id` - æ›´æ–°è®¢å•
- âœ… `DELETE /orders/:id` - åˆ é™¤è®¢å•
- âœ… `POST /orders/:id/ship` - å‘è´§ï¼ˆè°ƒç”¨é«˜å¾·APIè§„åˆ’è·¯å¾„ï¼‰
- âœ… `POST /orders/:id/deliver` - ç¡®è®¤é€è¾¾
- âœ… `POST /orders/batch/ship` - æ‰¹é‡å‘è´§
- âœ… `DELETE /orders/batch` - æ‰¹é‡åˆ é™¤

### 10.4 é…é€åŒºåŸŸæ¥å£
- âœ… `GET /delivery-zones` - é…é€åŒºåŸŸåˆ—è¡¨
- âœ… `POST /delivery-zones` - åˆ›å»ºé…é€åŒºåŸŸ
- âœ… `GET /delivery-zones/:id/orders` - åŒºåŸŸå†…è®¢å•
- âœ… `PATCH /delivery-zones/:id` - æ›´æ–°é…é€åŒºåŸŸ
- âœ… `DELETE /delivery-zones/:id` - åˆ é™¤é…é€åŒºåŸŸ

### 10.5 ç‰©æµå…¬å¸æ¥å£
- âœ… `GET /logistics-companies` - ç‰©æµå…¬å¸åˆ—è¡¨ï¼ˆå…¬å¼€æ¥å£ï¼‰

### 10.6 æ•°æ®ç»Ÿè®¡æ¥å£
- âœ… `GET /statistics/overview` - æ€»è§ˆç»Ÿè®¡ï¼ˆä»Šæ—¥è®¢å•/é‡‘é¢/è¿è¾“ä¸­ï¼‰
- âœ… `GET /statistics/zones` - é…é€åŒºåŸŸç»Ÿè®¡ï¼ˆè®¢å•æ•°/æ—¶æ•ˆï¼‰
- âœ… `GET /statistics/logistics` - ç‰©æµå…¬å¸ç»Ÿè®¡ï¼ˆè®¢å•æ•°/æ—¶æ•ˆ/å‡†ç‚¹ç‡ï¼‰

### 10.7 è¿½è¸ªæ¥å£ï¼ˆå…¬å¼€ï¼‰
- âœ… `GET /tracking/:orderNo` - è®¢å•è¿½è¸ªï¼ˆå«å®Œæ•´è·¯å¾„ç‚¹ï¼‰

### 10.8 WebSocket äº‹ä»¶
**å®¢æˆ·ç«¯äº‹ä»¶**ï¼š
- `subscribe(orderNo)` - è®¢é˜…è®¢å•æ›´æ–°
- `unsubscribe(orderNo)` - å–æ¶ˆè®¢é˜…

**æœåŠ¡ç«¯äº‹ä»¶**ï¼š
- `location_update` - ä½ç½®æ›´æ–°ï¼ˆæ¯5ç§’æ¨é€ï¼‰
- `status_update` - çŠ¶æ€æ›´æ–°
- `delivery_complete` - é…é€å®Œæˆ

---

## 11. å¼€å‘ç¯å¢ƒé…ç½®

### 11.1 åç«¯ç¯å¢ƒå˜é‡
```env
# æ•°æ®åº“
DATABASE_URL="postgresql://postgres:postgres@localhost:5432/delivery_viz?schema=public"

# JWT
JWT_SECRET="your-secret-key-here"
JWT_EXPIRES_IN="7d"

# é«˜å¾·åœ°å›¾
AMAP_KEY="your-amap-web-service-key"
```

### 11.2 ä¸€é”®å¯åŠ¨å‘½ä»¤
```bash
# åç«¯æœåŠ¡ï¼ˆä»é¡¹ç›®æ ¹ç›®å½•ï¼‰
kill -9 $(lsof -ti:3000) 2>/dev/null || true && \
cd backend && \
pnpm install && \
pnpm prisma:generate && \
pnpm prisma:push && \
pnpm prisma:seed && \
pnpm start:dev
```

### 11.3 æµ‹è¯•å‘½ä»¤
```bash
# å•å…ƒæµ‹è¯•
pnpm test:unit

# E2E æµ‹è¯•
pnpm test:e2e

# æ¼”ç¤ºæµ‹è¯•
pnpm demo

# äº¤äº’å¼æµ‹è¯•
pnpm demo:interactive
```

